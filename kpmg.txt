using System;
using System.Net.Http.Headers;
using System.Text;
using System.Net.Http;
using System.Web;


/* Assuming I have access to the accounts of all the companies using Azure. I request using the AD graph API all the users
 * of the company and get a JSON response, after getting access token for OAuth2. From that, I count all the users of the company. The total number is stored. I do the same for
 * all the companies. Then, I sort them from largest to smallest.*/

namespace Assignment
{
    static class LargestCompanies
    {
        public static int company = 0;

        static void Main()
        {
            int totalnumber = 500;
            int[] companies = new int[500];
            for (int i = 0; i <= 500; i++)
            {
                MakeRequest();
                companies[i] = company;
            }

            Array.Sort<int>(companies);

            Array.Reverse(companies);

            for (int i = 0; i <= 500; i++) {
                Console.WriteLine(companies[i]);
            }

        }

        static async void MakeRequest()
        {
            
            var client = new HttpClient();
            var queryString = HttpUtility.ParseQueryString(string.Empty);

            /* OAuth2 is required to access this API. For more information visit:
               https://msdn.microsoft.com/en-us/office/office365/howto/common-app-authentication-tasks */



            // Specify values for the following required parameters
            queryString["api-version"] = "1.6";

            // Specify values for optional parameters, as needed
            // queryString["$filter"] = "startswith(displayName,'A')";
            // Specify values for path parameters (shown as {...})
            var uri = "https://graph.windows.net/myorganization/users?" + queryString;


            var response = await client.GetAsync(uri);

            if (response.Content != null)
            {
                var responseString = await response.Content.ReadAsStringAsync();
                Console.WriteLine(responseString);
            }

            //Assuming I get the total number
            company = numberofuserspercompany;

            return;
            
        }
    }
}
